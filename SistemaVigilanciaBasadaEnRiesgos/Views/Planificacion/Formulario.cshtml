@model CapaModeloRBS.tbRespuesta

@{
    ViewBag.Title = "Formulario";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int indexSubt = 0;
    int indexOrientEstado = 0;
    int estadoImplementacionID = 0;
    string colorCelda = string.Empty;
    string selectColor = string.Empty;
}

<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">

            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="@Url.Action("Crear", "Planificacion")">Listas_Verificacones</a></li>
                    <li class="breadcrumb-item active">Formulario</li>                   
                </ol>
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        @using (Html.BeginForm("Formulario", "Planificacion", FormMethod.Post, new { id = "registerForm", enctype = "multipart/form-data", }))
                        {
                            @Html.HiddenFor(m => m.RespuestaID)
                            @Html.HiddenFor(m => m.ListaID)
                            @Html.HiddenFor(m => m.oOrganizacion.OrganizacionID)
                            @Html.HiddenFor(m => m.OrganizacionID)
                            @Html.HiddenFor(m => m.UsuarioID)
                            <div class="row">
                                <div class="col-sm-12 col-md-12">
                                    <div class="color-palette-set text-center" style="background-color:#c2bebe">
                                        <div> <h5> SISTEMA REGIONAL DE COOPERACIÓN PARA LA VIGILANCIA DE LA SEGURIDAD OPERACIONAL</h5></div>
                                        <div><strong id="tituloListaVerificacion">@Model.NombreLista &nbsp; @Model.DescripcionLista</strong></div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-12">
                                    <div class="card card-info">
                                        <div class="form-horizontal">
                                            <div class="card-body">
                                                <div class="form-group row">
                                                    <label for="OrganizacionID" class="col-sm-3 col-form-label col-form-label-sm">Nombre organización de mantenimiento:</label>
                                                    <div class="col-sm-9">
                                                        @Html.TextBoxFor(model => model.oOrganizacion.Nombre, new { @class = "form-control form-control-sm", @readonly = "readonly", autocomplete = "off", maxlength = "100" })
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="oOrganizaciones_Direccion" class="col-sm-3 col-form-label col-form-label-sm">Dirección:</label>
                                                    <div class="col-sm-9">
                                                        @Html.TextBoxFor(model => model.oOrganizacion.Direccion, new { @class = "form-control form-control-sm text-uppercase", @readonly = "readonly", autocomplete = "off", maxlength = "255" })
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="oOrganizaciones_GerenteResponsable" class="col-sm-3 col-form-label col-form-label-sm">Nombre gerente responsable:</label>
                                                    <div class="col-sm-9">
                                                        @Html.TextBoxFor(model => model.oOrganizacion.GerenteResponsable, new { @class = "form-control form-control-sm text-uppercase", @readonly = "readonly", autocomplete = "off", maxlength = "255" })
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="Certificado" class="col-sm-3 col-form-label col-form-label-sm">No. certificado OMA:</label>
                                                    <div class="col-sm-9">
                                                        @Html.TextBoxFor(model => model.Certificado, new { @class = "form-control form-control-sm text-uppercase", @readonly = "readonly", autocomplete = "off", maxlength = "60" })
                                                    </div>
                                                </div>

                                                <div class="form-group row">
                                                    <label for="FechaInicio" class="col-sm-3 col-form-label col-form-label-sm">Fecha inicio:</label>
                                                    <div class="col-sm-3">
                                                        @Html.TextBoxFor(model => model.FechaInicio, new { @class = "form-control form-control-sm ", @readonly = "readonly", autocomplete = "off", maxlength = "60" })
                                                    </div>
                                                    <label for="FechaFin" class="col-sm-1 col-form-label col-form-label-sm">Fecha Término:</label>
                                                    <div class="col-sm-3">
                                                        @Html.TextBoxFor(model => model.FechaFin, new { @class = "form-control form-control-sm ", @readonly = "readonly", autocomplete = "off", maxlength = "60" })
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="oOrganizaciones_Telefono" class="col-sm-3 col-form-label col-form-label-sm">Télefono:</label>
                                                    <div class="col-sm-9">
                                                        @Html.TextBoxFor(model => model.oOrganizacion.Telefono, new { @class = "form-control form-control-sm text-uppercase", autocomplete = "off", maxlength = "40" })
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="oOrganizaciones_Correo" class="col-sm-3 col-form-label col-form-label-sm">Correo electrónico:</label>
                                                    <div class="col-sm-9">
                                                        @Html.TextBoxFor(model => model.oOrganizacion.Correo, new { @class = "form-control form-control-sm", @type = "email", @readonly = "readonly", autocomplete = "off", maxlength = "100" })
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="UsuarioID" class="col-sm-3 col-form-label col-form-label-sm">Inspector responsable vigilancia:</label>
                                                    <div class="col-sm-9">
                                                        @Html.TextBoxFor(model => model.oInspector.Nombres, new { @class = "form-control form-control-sm", autocomplete = "off", @readonly = "readonly", maxlength = "100" })
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="InspectoresResponsables" class="col-sm-3 col-form-label col-form-label-sm">Inspectores:</label>
                                                    <div class="col-sm-9">
                                                        @Html.TextBoxFor(model => model.NombreInpectores, new { @class = "form-control form-control-sm", @readonly = "readonly", autocomplete = "off", maxlength = "100" })
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-12">
                                    <div class="color-palette-set text-center" style="background-color:#628caa">
                                        <div><strong>@Model.NombreLista &nbsp; @Model.DescripcionLista</strong></div>
                                    </div>
                                </div>

                                <div class="col-sm-12 col-md-12">
                                    <div class="form-group row">
                                        <input type="text" id="buscar" placeholder="Buscar..." onkeyup="filtrarTabla()">
                                    </div>
                                </div>
                                <table id="tablaLV" class="table table-bordered table-hover table-sm" style="width:100%; font-size:12px">
                                    <thead>
                                        <tr class="text-center">
                                            <th style="display: none;">ID</th>
                                            <th class="col-sm-1">Referencia</th>
                                            <th class="col-sm-2">Pregunta del requisito</th>
                                            <th class="col-sm-1">Estado de cumplimiento del requisito</th>
                                            <th class="col-sm-3">Orientación para el examen de pruebas o evidencias</th>
                                            <th class="col-sm-1">Codificación /Código de peligro</th>
                                            <th class="col-sm-2">Estado de implementación / IdR</th>
                                            <th class="col-sm-2">Comentarios</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var itemst in Model.oRespuestaSubtitulo)
                                        {
                                            <tr>
                                                <td colspan="8" class="text-center text-white" style="background-color:#628caa">
                                                    <strong>@itemst.Nombre.ToUpper()</strong>
                                                </td>
                                            </tr>
                                            foreach (var itemP in itemst.oDetalleRespuesta)
                                            {
                                                indexOrientEstado = itemP.oRespuestaOrientacion.Count();
                                                <tr>
                                                    <td style="display: none;">@Html.DisplayFor(modelItem => itemP.DetalleRespuestaID)</td>
                                                    <td style="display: none;">@itemP.oRespuestaOrientacion.First().RespuestaOrientacionID</td>
                                                    <td rowspan="@indexOrientEstado.ToString()"><p class="text-center" style="font-size:11px"><strong>@itemP.ReferenciaPregunta</strong></p></td>
                                                    <td rowspan="@indexOrientEstado.ToString()"><p><strong>@itemP.DescripcionPregunta</strong></p></td>
                                                    <td rowspan="@indexOrientEstado.ToString()" ; style="background-color:@itemP.Color">@Html.DisplayFor(modelItem => itemP.Estado)</td>
                                                    <td>@itemP.oRespuestaOrientacion.First().DescripcionOrientacion.TrimEnd()</td>
                                                    <td>@itemP.oRespuestaOrientacion.First().CodigoPeligro.TrimEnd()</td>
                                                    <td style="background-color:@itemP.oRespuestaOrientacion.First().Color">
                                                        <select class="form-control  select2-danger color-selector" data-dropdown-css-class="select2-danger" style="background-color:@itemP.oRespuestaOrientacion.First().Color; width: 100%;">

                                                            @if (@itemP.oRespuestaOrientacion.First().EstadoImplementacionID > 0)
                                                            {
                                                                <option style="background-color:#ffffff" value="0" selected="selected">Seleccionar</option>
                                                            }
                                                            else
                                                            {
                                                                <option style="background-color:#ffffff" value="0">Seleccionar</option>
                                                            }
                                                            @foreach (var itemEst in @itemP.oRespuestaOrientacion.First().oOrientacionEstado)
                                                            {
                                                                if (@itemP.oRespuestaOrientacion.First().EstadoImplementacionID == itemEst.OrientacionEstadoID)
                                                                {
                                                                    <option selected="selected" style="background-color:@itemEst.Color" value="@itemEst.OrientacionEstadoID">@itemEst.oEstadoDeImplementacion.Descripcion</option>

                                                                }
                                                                else
                                                                {
                                                                    <option style="background-color:@itemEst.Color" value="@itemEst.OrientacionEstadoID">@itemEst.oEstadoDeImplementacion.Descripcion</option>
                                                                }

                                                            }

                                                        </select>

                                                    </td>
                                                    <td>
                                                        <div class="col-sm-12">
                                                            <div class="input-group">
                                                                @Html.TextBoxFor(model => @itemP.oRespuestaOrientacion.First().Comentario, new { @class = "form-control form-control-sm text-uppercase", autocomplete = "off", maxlength = "500" })
                                                                <div class="input-group-append">
                                                                    <div class="btn waves-effect waves-light btn-outline-primary btn-sm">
                                                                        <i onclick="modalConstataciones(@itemP.oRespuestaOrientacion.First().RespuestaOrientacionID)"><img src="~/Content/imganes/procesoAutHabilita.png" style="width:15px" /></i>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                int indexO = 0;
                                                foreach (var itemO in itemP.oRespuestaOrientacion)
                                                {
                                                    if (indexO > 0)
                                                    {
                                                        <tr>
                                                            <td style="display: none;">@Html.DisplayFor(modelItem => itemO.DetalleRespuestaID)</td>
                                                            <td style="display: none;">@Html.DisplayFor(modelItem => itemO.RespuestaOrientacionID)</td>
                                                            <td>@Html.DisplayFor(modelItem => itemO.DescripcionOrientacion)</td>
                                                            <td>@Html.DisplayFor(modelItem => itemO.CodigoPeligro)</td>
                                                            <td style="background-color:@itemO.Color">
                                                                <select class="form-control select2-danger color-selector" data-dropdown-css-class="select2-danger" style="background-color:@itemO.Color; width: 100%;">
                                                                    @if (@itemO.EstadoImplementacionID > 0)
                                                                    {
                                                                        <option value="0" selected="selected">Seleccionar</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="0">Seleccionar</option>
                                                                    }
                                                                    @foreach (var itemEst in itemO.oOrientacionEstado)
                                                                    {
                                                                        if (@itemO.EstadoImplementacionID == itemEst.OrientacionEstadoID)
                                                                        {
                                                                            <option selected="selected" style="background-color:@itemEst.Color" value="@itemEst.OrientacionEstadoID">@itemEst.oEstadoDeImplementacion.Descripcion</option>

                                                                        }
                                                                        else
                                                                        {
                                                                            <option style="background-color:@itemEst.Color" value="@itemEst.OrientacionEstadoID">@itemEst.oEstadoDeImplementacion.Descripcion</option>

                                                                        }


                                                                    }
                                                                </select>
                                                            </td>
                                                            <td>
                                                                <div class="col-sm-12">
                                                                    <div class="input-group">
                                                                        @Html.TextBoxFor(model => @itemO.Comentario, new { @class = "form-control form-control-sm text-uppercase", autocomplete = "off", maxlength = "500" })
                                                                        <div class="input-group-append">
                                                                            <div class="btn waves-effect waves-light btn-outline-primary btn-sm">
                                                                                <i onclick="modalConstataciones(@itemO.RespuestaOrientacionID)"><img src="~/Content/imganes/procesoAutHabilita.png" style="width:15px" /></i>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    }
                                                    indexO++;
                                                }
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalConstataciones" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <form enctype="multipart/form-data">
                    <input type="hidden" id="cRespuestaOrientacionID"/>
                    <div class="modal-header">                        
                        <table class="table table-striped table-bordered table-sm table-responsive-sm" style="width:100%">
                            <tr>
                                <th colspan="2" class="text-center text-blue">C O N S T A T A C I O N E S</th>
                            </tr>
                            <tr>
                                <th>Lista verificación</th>
                                <th class="text-center">
                                    <strong class="tituloCostatlv"></strong>
                                </th>
                            </tr>
                            <tr>
                                <th>SubTitulo: </th>
                                <th class="text-blue">
                                    <input type="text" class="form-control text-center" id="cnombreSubtitulo" readonly="readonly">
                                </th>
                            </tr>
                            <tr>
                                <th>Pregunta: </th>
                                <th class="text-blue">
                                    <textarea class="form-control" id="cDescripcionPregunta" rows="2" readonly></textarea>
                                </th>
                            </tr>
                            <tr>
                                <th>Orientación: </th>
                                <th class="text-blue">
                                    <textarea class="form-control" id="cDescripcionOrientacion" rows="4" readonly></textarea>
                                </th>
                            </tr>
                        </table>
                    </div>
                    <div class="modal-body" style="font-size:14px">
                        <a class="btn btn-outline-success btn-sm" href="#" onclick="modalConstatacionNuevo(-1)">Nuevo registro</a>
                        <div class="card-body">
                            <div class="row" id="inner-right">
                                <div class="col-sm-12">
                                    <table id="tbConstataciones" class="table table-striped table-bordered table-sm table-responsive-sm" style="width:100%">
                                        <thead>
                                            <tr>
                                                <th class="text-center">OID</th>
                                                <th class="text-center">AREA</th>
                                                <th class="text-center">DESCRIPCIÓN</th>
                                                <th class="text-center">FECHA</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>                 
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger btn-sm" data-dismiss="modal"><img src="~/Content/imganes/cancel.png" style="width:25px" /> Salir</button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalConstatacion" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <form enctype="multipart/form-data">
                    <div class="modal-header">
                        <table class="table table-striped table-bordered table-sm nowrap compact" style="width:100%">
                            <tr>
                                <th colspan="2" class="text-center text-blue">C O N S T A T A C I Ó N</th>
                            </tr>
                            <tr>
                                <th>Lista verificación: </th>
                                <th class="text-center">
                                    <strong class="tituloCostatlv"></strong>                                    
                                </th>
                            </tr>
                            <tr>
                                <th>SubTitulo: </th>
                                <th class="text-center">
                                    <input type="text" class="form-control form-control-sm text-center" id="tcnombreSubtitulo" readonly="readonly">
                                </th>
                            </tr>
                            <tr>
                                <th>Pregunta: </th>
                                <th class="text-center">
                                    <textarea class="form-control form-control-sm" id="tcDescripcionPregunta" rows="2" readonly></textarea>
                                </th>
                            </tr>
                            <tr>
                                <th>Orientación: </th>
                                <th class="text-center">
                                    <textarea class="form-control form-control-sm" id="tcDescripcionOrientacion" rows="3" readonly></textarea>
                                </th>
                            </tr>
                        </table>
                       
                    </div>
                    <div class="modal-body" style="font-size:12px">
                        <div style="height: 500px">
                            <div class="row overflow-hidden">
                                <div class="col-12 h-100">
                                    <div class="card">
                                        <div class="card-body">
                                            <input id="ConstatacionID" name="ConstatacionID" type="hidden" value="Value">
                                            <input id="cRespuestaOrientacionID" name="cRespuestaOrientacionID" type="hidden" value="Value">
                                            <div class="form-horizontal">
                                                <div class="form-group row">
                                                    <label for="inputEmail3" class="col-sm-3 col-form-label">Area</label>
                                                    <div class="col-sm-9">
                                                        @if (ViewBag.ListaAreas != null)
                                                        {
                                                            @Html.DropDownList("AreaID", new SelectList(ViewBag.ListaAreas, "Value", "Text"), new { @class = "form-control" })
                                                        }

                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="FechaConstatacion" class="col-sm-3 col-form-label">Fecha</label>
                                                    <div class="col-sm-9">
                                                        <input type="date" class="form-control" id="FechaConstatacion">
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="PresuntaInfraccion" class="col-sm-3 col-form-label">Presunta infracción</label>
                                                    <div class="col-sm-9">
                                                        <div class="custom-control custom-checkbox">
                                                            <input class="custom-control-input" type="checkbox" id="PresuntaInfraccion">
                                                            <label for="PresuntaInfraccion" class="custom-control-label"></label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="DescripcionConstatacion" class="col-sm-3 col-form-label">Descripción constatación</label>
                                                    <div class="col-sm-9">
                                                        <textarea class="form-control" id="DescripcionConstatacion" rows="3" placeholder="Descripción constatación"></textarea>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="EvidenviaNombre" class="col-sm-3 col-form-label">Evidencia</label>
                                                    <div class="col-sm-4">
                                                        <input type="text" class="form-control " id="EvidenviaNombre">
                                                    </div>
                                                    <div class="custom-file col-sm-4">
                                                        <input type="file" class="custom-file-input custom-select-sm" id="EvidenciaArchivo">
                                                        <label class="custom-file-label col-form-label-sm" for="EvidenciaArchivo">Evidencia archivo</label>
                                                    </div>
                                                    <button type="button" id="btnAgregarArchivoMemoria" class="btn btn-outline-primary btn-sm" onclick="AgregarArchivoMemoria()"> + Agergar </button>
                                                </div>
                                                <div class="form-group row">
                                                    <div class="col-12">
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading">Adjuntos de evidencia</div>
                                                            <div class="panel-body">
                                                                <ul id="listaArchivos" class="list-group">
                                                                    <!-- Aquí se mostrarán los archivos añadidos -->
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <div class="col-sm-12">
                                                        <table id="tbEvidencia" class="table table-striped table-bordered table-sm nowrap compact" style="width:100%">
                                                            <thead>
                                                                <tr>
                                                                    <th>Evidencia</th>
                                                                    <th>Archivo</th>
                                                                    <th></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="AfectaSO" class="col-sm-3 col-form-label">Afecta S.O</label>
                                                    <div class="col-sm-9">
                                                        <div class="custom-control custom-checkbox">
                                                            <input class="custom-control-input" type="checkbox" id="AfectaSO">
                                                            <label for="AfectaSO" class="custom-control-label"></label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group row">
                                                    <label for="NotaAfectaSO" class="col-sm-3 col-form-label">Nota afecta S.O</label>
                                                    <div class="col-sm-9">
                                                        <textarea class="form-control" id="NotaAfectaSO" rows="3" placeholder="Nota afecta S.O"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <div class="float-left">
                                                    <div id="loadImagenEnviar" style="display: none;">
                                                        <img src="~/Content/imganes/loadingHorizontal.gif" />
                                                    </div>
                                                </div>
                                                <button type="button" class="btn btn-danger btn-sm col-sm-3" onclick='salirConstatacion()'><img src="~/Content/imganes/cancel.png" style="width:30px" /> Salir</button>
                                                <button class='btn btn-primary btn-sm col-sm-3' type='button' id="btnGrabarAeronave" onclick='grabarContatacion()'> <i><img src="~/Content/imganes/save.png" style="width:30px" />  Grabar</i> </button>
                                            </div>
                                        </div>   
                                    </div>
                                </div>
                            </div>
                        </div>   
                        
                    </div>

                </form>
            </div>
        </div>
    </div>
</section>



@section scripts{
    <script src="@Url.Content("~/Scripts/Views/Formulario_Crear.js")" type="text/javascript"></script>
}


